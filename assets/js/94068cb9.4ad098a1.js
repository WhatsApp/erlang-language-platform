"use strict";(self.webpackChunkstaticdocs_starter=self.webpackChunkstaticdocs_starter||[]).push([[8390],{66427:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"contributing/linters/linters-step-3-tests","title":"Test your linter","description":"Add a snapshot test","source":"@site/docs/contributing/linters/linters-step-3-tests.md","sourceDirName":"contributing/linters","slug":"/contributing/linters/linters-step-3-tests","permalink":"/erlang-language-platform/docs/contributing/linters/linters-step-3-tests","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"Test your linter"},"sidebar":"tutorialSidebar","previous":{"title":"Create the linter module","permalink":"/erlang-language-platform/docs/contributing/linters/linters-step-2-module"},"next":{"title":"Document your linter","permalink":"/erlang-language-platform/docs/contributing/linters/linters-step-4-documentation"}}');var o=t(74848),r=t(28453);const i={sidebar_position:3,title:"Test your linter"},a=void 0,c={},l=[{value:"Add a snapshot test",id:"add-a-snapshot-test",level:3},{value:"Try the new linter from the CLI",id:"try-the-new-linter-from-the-cli",level:3}];function d(e){const n={code:"code",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h3,{id:"add-a-snapshot-test",children:"Add a snapshot test"}),"\n",(0,o.jsxs)(n.p,{children:["At the bottom of the ",(0,o.jsx)(n.code,{children:"no_unsafe_operation.rs"})," file, add the following:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-rust",metastring:"showLineNumbers",children:'#[cfg(test)]\nmod tests {\n    use crate::tests::check_diagnostics;\n\n    #[test]\n    fn test_no_unsafe_operation() {\n        check_diagnostics(\n            r#"\n            //- /src/main.erl\n            -module(main).\n            -export([warn/0]).\n            warn() ->\n                unsafe:operation(data),\n            %%  ^^^^^^^^^^^^^^^^^^^^^^ \ud83d\udca1 warning: Do not use unsafe:operation/1 in production code.\n                safe:operation(data).\n            //- /src/unsafe.erl\n            -module(unsafe).\n            -export([operation/1]).\n            operation(_) -> ok.\n            //- /src/safe.erl\n            -module(safe).\n            -export([operation/1]).\n            operation(_) -> ok.\n            "#,\n        );\n    }\n}\n'})}),"\n",(0,o.jsxs)(n.p,{children:["ELP uses convenient snapshot tests for checking diagnostics. The test above\nchecks that the diagnostic is correctly reported when calling\n",(0,o.jsx)(n.code,{children:"unsafe:operation/1"}),". It also checks that the diagnostic is not reported when\ncalling ",(0,o.jsx)(n.code,{children:"safe:operation/1"}),"."]}),"\n",(0,o.jsx)(n.p,{children:"Always include comprehensive tests in your diagnostic module:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Positive cases"})," - Code that should trigger the diagnostic"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Negative cases"})," - Similar code that should NOT trigger the diagnostic"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Edge cases"})," - Boundary conditions and unusual syntax"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"You can run the tests with the following command:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"cargo test --package elp_ide --lib -- diagnostics::no_unsafe_operation::tests::test_no_unsafe_operation --exact --show-output\n"})}),"\n",(0,o.jsx)(n.h3,{id:"try-the-new-linter-from-the-cli",children:"Try the new linter from the CLI"}),"\n",(0,o.jsxs)(n.p,{children:["You can also try the new linter against a hypothetical ",(0,o.jsx)(n.code,{children:"my_module"})," Erlang\nmodule:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"cargo run --bin elp -- lint --project /path/to/your/project --module my_module --diagnostic-filter no_unsafe_operation\n"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"Diagnostics reported in 1 modules:\n  my_module: 1\n      29:4-29:25::[Warning] [W0055] Do not use unsafe:operation/1 in production code.\n"})})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>a});var s=t(96540);const o={},r=s.createContext(o);function i(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);